<!-- Main Layout -->
<div class="app-container">
  <!-- Top Navigation -->
  <div class="top-nav-section">
    <nav class="top-nav">
      <div class="d-flex justify-content-between align-items-center w-100">
        <div class="logo">
          <i class="fas fa-leaf logo-icon"></i>
          <h1 class="logo-text">Smart Agriculture</h1>
        </div>
        <div class="d-flex align-items-center">
          <div class="theme-toggle me-4">
            <button (click)="toggleTheme()" class="btn btn-sm">
              <i class="fas" [ngClass]="isDarkMode ? 'fa-sun' : 'fa-moon'"></i>
            </button>
          </div>
          <div class="notification-bell me-4 dropdown">
            <button class="btn p-0 notification-btn" type="button" id="notificationDropdown" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fas fa-bell"></i>
              <span class="badge">3</span>
            </button>
            <ul class="dropdown-menu notification-dropdown" aria-labelledby="notificationDropdown">
              <li class="dropdown-header">Notifications</li>
              <li><a class="dropdown-item" href="#"><i class="fas fa-water text-primary me-2"></i> Irrigation completed</a></li>
              <li><a class="dropdown-item" href="#"><i class="fas fa-bug text-warning me-2"></i> Pest control alert</a></li>
              <li><a class="dropdown-item" href="#"><i class="fas fa-seedling text-success me-2"></i> New crop planted</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-center" href="#">View all notifications</a></li>
            </ul>
          </div>
          <div class="user-profile dropdown">
            <button class="btn p-0 profile-btn" type="button" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
              <img src="https://randomuser.me/api/portraits/men/42.jpg" alt="User" class="user-avatar">
            </button>
            <ul class="dropdown-menu profile-dropdown" aria-labelledby="profileDropdown">
              <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i> Profile</a></li>
              <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i> Settings</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item"  routerLink="/home-page" (click)="logout()"><i class="fas fa-sign-out-alt me-2"></i> Logout</a></li>
            </ul>
          </div>
        </div>
      </div>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Dashboard Content -->
    <div class="container-fluid p-4">
      <!-- Welcome Section with Stats -->
      <div class="welcome-section-wrapper mb-4">
        <div class="welcome-section">
          <div class="row">
            <div class="col-md-8">
              <h2 class="section-title">Welcome,Yahya</h2>
              <p class="text-muted mb-4">Here's what's happening with your farms today</p>
              
              <div class="stats-section">
                <div class="row mt-3">
                  <div class="col-md-3 col-sm-6 mb-3">
                    <div class="stat-card">
                      <div class="stat-icon"><i class="fas fa-seedling"></i></div>
                      <div class="stat-info">
                        <h3>{{farms.length}}</h3>
                        <p>Total Farms</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3 col-sm-6 mb-3">
                    <div class="stat-card">
                      <div class="stat-icon"><i class="fas fa-ruler-combined"></i></div>
                      <div class="stat-info">
                        <h3>
                          {{getTotalAcres()}}
                      </h3>
                        <p>Total Acres</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3 col-sm-6 mb-3">
                    <div class="stat-card">
                      <div class="stat-icon"><i class="fas fa-tint"></i></div>
                      <div class="stat-info">
                        <h3>{{getAverageHealth()}}%</h3>
                        <p>Avg. Health</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3 col-sm-6 mb-3">
                    <div class="stat-card">
                      <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
                      <div class="stat-info">
                        <h3>3</h3>
                        <p>Tasks Today</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="weather-widget-section">
                <div class="weather-widget">
                  <div class="weather-header">
                    <h5>Weather Forecast</h5>
                    <span>Riverside County</span>
                  </div>
                  <div class="weather-content">
                    <div class="current-weather">
                      <i class="fas fa-sun"></i>
                      <div class="temp">78°F</div>
                    </div>
                    <div class="weather-details">
                      <div class="detail"><i class="fas fa-wind"></i> 5 mph</div>
                      <div class="detail"><i class="fas fa-tint"></i> 20%</div>
                      <div class="detail"><i class="fas fa-cloud"></i> 10%</div>
                    </div>
                  </div>
                  <div class="weather-forecast">
                    <div class="forecast-day">
                      <div>Mon</div>
                      <i class="fas fa-sun"></i>
                      <div>80°</div>
                    </div>
                    <div class="forecast-day">
                      <div>Tue</div>
                      <i class="fas fa-cloud-sun"></i>
                      <div>76°</div>
                    </div>
                    <div class="forecast-day">
                      <div>Wed</div>
                      <i class="fas fa-cloud"></i>
                      <div>72°</div>
                    </div>
                    <div class="forecast-day">
                      <div>Thu</div>
                      <i class="fas fa-cloud-sun"></i>
                      <div>75°</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="charts-section-wrapper mb-4">
        <div class="row  chart-row">
          <div class="col-md-8">
            <div class="chart-container">
              <div class="chart-header">
                <h5>Farm Productivity</h5>
                <div class="chart-actions">
                  <button class="btn btn-sm btn-outline-secondary active">Monthly</button>
                </div>
              </div>
              <div class="chart-body">
                <canvas id="productivityChart"></canvas>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="chart-container">
              <div class="chart-header">
                <h5>Crop Distribution</h5>
              </div>
              <div class="chart-body">
                <canvas id="cropDistributionChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- My Farms Section -->
      <div class="farms-section-wrapper mb-4">
        <div class="farms-section">
          <div class="section-header d-flex justify-content-between align-items-center mb-3">
            <h2 class="section-title">My Farms</h2>
            <div class="section-actions">
              <button class="btn btn-sm btn-outline-secondary me-2" data-bs-toggle="modal" data-bs-target="#filterFarmModal"><i class="fas fa-filter"></i> Filter</button>
              <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addFarmModal">
                <i class="fas fa-plus"></i> Add Farm
              </button>
            </div>
          </div>

          <div class="farm-cards-container d-flex flex-row gap-3 scroll-cards pt-3 " id="scrollContainer">
            <div class="farm-scroll-container">
              <div class="farm-scroll-wrapper">
            <!-- Farm Cards -->
            <div class=" d-flex flex-row farm-card " id="farmCardsContainer" *ngFor="let farm of farms" >
              <!-- Example Farm Card (Repeat for others or use *ngFor) -->
              <div class="d-flex flex-wrap    ">
                <div class="farm-card" >
                  <div class="farm-card-header">
                    <span class="farm-status" [ngClass]="getStatusClass(farm.getOverAllStatus() || 0)"></span>

                    <button type="button" class="btn btn-sm btn-delete" (click)="openDeleteModal(farm.getId())" data-bs-toggle="modal" data-bs-target="#deleteFarmModal">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                  <div class="card-body">
                    <h5 class="card-title">{{farm.getFarmName()}}</h5>
                    <div class="farm-details">
                      <div class="detail-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>{{farm.getFarmLocation()}}</span>
                      </div>
                      <div class="detail-item">
                        <i class="fas fa-ruler-combined"></i>
                        <span>{{farm.getFarmSize()}} acres</span>
                      </div>
                    </div>
                    <div class="farm-health">
                      <div class="health-label">Farm Health</div>
                      <div class="progress">
                        <div class="progress-bar bg-success" role="progressbar" [style.width.%]="farm.getOverAllStatus()" [attr.aria-valuenow]="farm.getOverAllStatus()" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>
                      <div class="health-value">{{farm.getOverAllStatus()}}%</div>
                    </div>
                    <div class="farm-actions mt-2">
                      <button (click)="View(farm.getId(),farm.getFarmLocation(),farm.getFarmSize(),farm.getFarmName())" class="btn btn-sm btn-outline-secondary view-farm-btn"><i class="fas fa-eye"></i> View</button>
                      <button (click)="openEditModal(farm.getId())" class="btn btn-sm btn-outline-secondary edit-farm-btn" data-bs-toggle="modal" data-bs-target="#editFarmModal"><i class="fas fa-edit"></i> Edit</button>
                    </div>
                  </div>
                </div>
              </div>
              </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Activities Section -->
      <div class="recent-activities-section-wrapper mb-4">
        <div class="recent-activities">
          <div class="section-header d-flex justify-content-between align-items-center mb-3">
            <h2 class="section-title">Recent Activities</h2>
            <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#allActivitiesModal">View All</button>
          </div>
          <div class="activity-list">
            <div class="row">
              <div class="col-lg-6">
                <div class="activity-item">
                  <div class="activity-icon"><i class="fas fa-water"></i></div>
                  <div class="activity-content">
                    <div class="activity-title">Irrigation completed</div>
                    <div class="activity-details">Green Valley Farm - North Section</div>
                    <div class="activity-time">Today, 10:30 AM</div>
                  </div>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="activity-item">
                  <div class="activity-icon"><i class="fas fa-bug"></i></div>
                  <div class="activity-content">
                    <div class="activity-title">Pest control alert</div>
                    <div class="activity-details">Highland Ranch - East Field</div>
                    <div class="activity-time">Yesterday, 4:15 PM</div>
                  </div>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="activity-item">
                  <div class="activity-icon"><i class="fas fa-seedling"></i></div>
                  <div class="activity-content">
                    <div class="activity-title">New crop planted</div>
                    <div class="activity-details">Sunny Meadows - South Field</div>
                    <div class="activity-time">May 22, 2025</div>
                  </div>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="activity-item">
                  <div class="activity-icon"><i class="fas fa-truck"></i></div>
                  <div class="activity-content">
                    <div class="activity-title">Harvest delivered</div>
                    <div class="activity-details">Eastwood Fields - 2.5 tons</div>
                    <div class="activity-time">May 20, 2025</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modals Section -->
<div class="modals-section">
  <!-- Add Farm Modal -->
  <div class="modal fade  " id="addFarmModal" tabindex="-1" aria-labelledby="addFarmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addFarmModalLabel">Add New Farm</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="addFarmForm" (ngSubmit)="onAddFarmSubmit()">
            <div class="mb-3">
              <label for="addFarmName" class="form-label">Farm Name</label>
              <input type="text" class="form-control" id="addFarmName" formControlName="farmName">
              <div *ngIf="addFarmForm.get('farmName')?.invalid && addFarmForm.get('farmName')?.touched" class="text-danger">
                Farm name is required
              </div>        
            </div>
            <div class="mb-3">
              <label for="addFarmSize" class="form-label">Farm Size (acres)</label>
              <input type="number" class="form-control" id="addFarmSize" formControlName="farmSize">
              <div *ngIf="addFarmForm.get('farmSize')?.invalid && addFarmForm.get('farmSize')?.touched" class="text-danger">
                Farm size is required
              </div>
            </div>
            <div class="mb-3">
              <label for="addFarmLocation" class="form-label">Farm Location</label>
              <input type="text" class="form-control" id="addFarmLocation" formControlName="farmLocation">
              <div *ngIf="addFarmForm.get('farmLocation')?.invalid && addFarmForm.get('farmLocation')?.touched" class="text-danger">
                Farm location is required
              </div>            </div>
            <div class="modal-footer gap-2">
              <button type="button" class="btn btn-secondary" (click)="addFarmForm.reset()" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-success" [disabled]="!addFarmForm.valid">Add Farm</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Farm Modal -->
  <div class="modal fade" id="editFarmModal" tabindex="-1" aria-labelledby="editFarmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editFarmModalLabel">Edit Farm</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="editFarmForm" (ngSubmit)="onEditFarmSubmit()">
            <input type="hidden" formControlName="farmId">
            <div class="mb-3">
              <label for="editFarmName" class="form-label">Farm Name</label>
              <input type="text" class="form-control" id="editFarmName" formControlName="farmName">
              <!-- Add validation messages here if needed -->
            </div>
            <div class="mb-3">
              <label for="editFarmSize" class="form-label">Farm Size (acres)</label>
              <input type="number" class="form-control" id="editFarmSize" formControlName="farmSize">
              <!-- Add validation messages here if needed -->
            </div>
            <div class="mb-3">
              <label for="editFarmLocation" class="form-label">Farm Location</label>
              <input type="text" class="form-control" id="editFarmLocation" formControlName="farmLocation">
              <!-- Add validation messages here if needed -->
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" (click)="editFarmForm.reset() " data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-success" [disabled]="!editFarmForm.valid">Save Changes</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Filter Farm Modal -->
  <div class="modal fade" id="filterFarmModal" tabindex="-1" aria-labelledby="filterFarmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="filterFarmModalLabel">Filter Farms</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" (click)="resetFilters()" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="filterFarmForm" (ngSubmit)="applyFilters(filterFarmForm.value)">
            <div class="mb-3">
              <label for="filterFarmHealth" class="form-label">Minimum Farm Health</label>
              <div class="d-flex align-items-center">
                <input type="range" class="form-range flex-grow-1 me-2" id="filterFarmHealth" formControlName="minHealth" min="0" max="100">
                <span id="filterFarmHealthValue">{{ filterFarmForm.get('minHealth')?.value || 0 }}%</span>
              </div>
            </div>
            <div class="mb-3">
              <label for="filterFarmSize" class="form-label">Minimum Farm Size (acres)</label>
              <input type="number" class="form-control" id="filterFarmSize" formControlName="minSize" min="0">
              <!-- Add validation messages here if needed -->
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" (click)="resetFilters()">Reset Filters</button>
              <button type="submit" class="btn btn-success" data-bs-dismiss="modal" >Apply Filters</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Farm Modal -->
  <div class="modal fade" id="deleteFarmModal" tabindex="-1" aria-labelledby="deleteFarmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteFarmModalLabel">Delete Farm</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete this farm? This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" (click)="deleteFarm()">Delete</button> <!-- Assuming a deleteFarm method exists -->
        </div>
      </div>
    </div>
  </div>

  <!-- All Activities Modal -->
  <div class="modal fade" id="allActivitiesModal" tabindex="-1" aria-labelledby="allActivitiesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="allActivitiesModalLabel">All Activities</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="activity-list">
            <!-- Static content for now, could be dynamic with *ngFor -->
            <div class="activity-item mb-3">
                <div class="activity-icon"><i class="fas fa-water"></i></div>
                <div class="activity-content">
                    <div class="activity-title">Irrigation completed</div>
                    <div class="activity-details">Green Valley Farm - North Section</div>
                    <div class="activity-time">Today, 10:30 AM</div>
                </div>
            </div>
            <div class="activity-item mb-3">
                <div class="activity-icon"><i class="fas fa-bug"></i></div>
                <div class="activity-content">
                    <div class="activity-title">Pest control alert</div>
                    <div class="activity-details">Highland Ranch - East Field</div>
                    <div class="activity-time">Yesterday, 4:15 PM</div>
                </div>
            </div>
             <div class="activity-item mb-3">
                <div class="activity-icon"><i class="fas fa-seedling"></i></div>
                <div class="activity-content">
                    <div class="activity-title">New crop planted</div>
                    <div class="activity-details">Sunny Meadows - South Field</div>
                    <div class="activity-time">May 22, 2025</div>
                </div>
            </div>
            <div class="activity-item mb-3">
                <div class="activity-icon"><i class="fas fa-truck"></i></div>
                <div class="activity-content">
                    <div class="activity-title">Harvest delivered</div>
                    <div class="activity-details">Eastwood Fields - 2.5 tons</div>
                    <div class="activity-time">May 20, 2025</div>
                </div>
            </div>
            <div class="activity-item mb-3">
                <div class="activity-icon"><i class="fas fa-tint"></i></div>
                <div class="activity-content">
                    <div class="activity-title">Soil moisture check</div>
                    <div class="activity-details">Green Valley Farm - All Sections</div>
                    <div class="activity-time">May 19, 2025</div>
                </div>
            </div>
            <div class="activity-item mb-3">
                <div class="activity-icon"><i class="fas fa-thermometer-half"></i></div>
                <div class="activity-content">
                    <div class="activity-title">Temperature alert</div>
                    <div class="activity-details">Highland Ranch - Greenhouse</div>
                    <div class="activity-time">May 18, 2025</div>
                </div>
            </div>
            <div class="activity-item mb-3">
                <div class="activity-icon"><i class="fas fa-tools"></i></div>
                <div class="activity-content">
                    <div class="activity-title">Equipment maintenance</div>
                    <div class="activity-details">All Farms - Irrigation Systems</div>
                    <div class="activity-time">May 15, 2025</div>
                </div>
            </div>
            <div class="activity-item">
                <div class="activity-icon"><i class="fas fa-chart-line"></i></div>
                <div class="activity-content">
                    <div class="activity-title">Yield forecast updated</div>
                    <div class="activity-details">All Farms - Q2 2025</div>
                    <div class="activity-time">May 10, 2025</div>
                </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>

